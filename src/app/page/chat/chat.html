<div class="app-shell">
  <!-- ðŸŸ¦ Universal Drawer (desktop + mobile) -->
  <p-drawer
    [(visible)]="drawerOpen"
    position="left"
    [modal]="false"
    [showCloseIcon]="false"
    [baseZIndex]="10000"
    styleClass="onyx-drawer"
  >
    <div class="brand">
      <h2>Onyx A.I+</h2>
      <button
        pButton
        icon="pi pi-times"
        class="p-button-rounded p-button-text"
        (click)="closeDrawer()"
      ></button>
    </div>

    <div class="new-chat">
      <div class="flex flex-col gap-4">
        <div class="radio-inputs">
          <div *ngFor="let api of apis" class="radio-tile-wrapper">
            <p-radiobutton
              [inputId]="api.key"
              name="category"
              [value]="api"
              [(ngModel)]="selectedApi"
              (ngModelChange)="clearChat(); closeDrawer()"
            ></p-radiobutton>

            <label class="radio-tile" [for]="api.key">
              <div class="radio-icon"><i class="pi pi-database"></i></div>
              <span class="radio-label">{{ api.name }}</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="conversations">
      <h6>Your conversations <span class="clear">Clear All</span></h6>
    </div>
  </p-drawer>

  <!-- ðŸŸ¢ Chat Area -->
  <main class="chat-area card">
    <div class="chat-header" style="background-color:#163d86;width:100%;">
      <div class="chat-title flex align-items-center gap-3">
        <!-- Drawer Toggle -->
        <button
          class="mobile-menu-btn"
          (click)="toggleSidebar()"
          pButton
          icon="pi pi-bars"
          class="p-button-rounded p-button-text"
        ></button>

        <div class="name" style="color:white;">
          {{ selectedApi.name }}
        </div>
      </div>
    </div>

    <div class="chat-body chat-scroll">
      <div
        *ngFor="let m of messageBoard()"
        class="message-row"
        [class.me]="m.from === 'me'"
      >
        <div class="bubble" [class.bot]="m.from === 'bot'">
          <div class="text" *ngIf="m.text">
            <span
              *ngIf="m.text === 'Loading'; else normalText"
              class="loading-dots"
              >Loading</span
            >
            <ng-template #normalText>{{ m.text }}</ng-template>
          </div>

          <div *ngIf="m.tableData && m.tableData.length">
            <p-table
              [value]="m.tableData"
              [paginator]="true"
              [rows]="10"
              [rowsPerPageOptions]="[10, 25, 50]"
              [showCurrentPageReport]="true"
              currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
              styleClass="p-datatable-sm p-datatable-gridlines"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th *ngFor="let col of m.tableData[0] | keyvalue">
                    {{ col.key }}
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-row>
                <tr>
                  <td *ngFor="let col of row | keyvalue">
                    {{ col.value || '-' }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>

          <div class="time">{{ m.time }}</div>
        </div>
      </div>
    </div>

    <div class="chat-input">
      <div class="input-box">
        <i class="pi pi-smile"></i>
        <textarea
          pInputTextarea
          rows="1"
          autoResize="true"
          placeholder="What's in your mind?..."
          [ngModel]="newMessage()"
          (ngModelChange)="newMessage.set($event)"
          (keydown.enter)="send()"
          [disabled]="isLoading()"
        ></textarea>
      </div>
      <button
        pButton
        icon="pi pi-send"
        class="send-button p-button-rounded"
        (click)="send()"
        [disabled]="isLoading()"
      ></button>
    </div>
  </main>
</div>
